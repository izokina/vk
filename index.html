<html>
 <head>
  <title>VK</title>
  <script src="//vk.com/js/api/openapi.js" type="text/javascript"></script>
  <style>
body {
  background-color : #ddddff;
}
#log, #log > div {
  border-style : solid;
  border-width : 1px;
}
#log {
  padding : 5px;
  background-color : #ffffee;
  border-color : #ffff00;
}
#log > div {
  margin : 8px;
  padding : 8px;
  background-color : #ddffcc;
  border-color : #55ff00;
}
#log > div.error {
  background-color : #ff9955;
  border-color : #ff0000;
}
  </style>
 </head>
 <body>
  <script type="text/javascript">
    VK.init({
      apiId: 1943647
    });
    var ME = {};
    ME.log = function(builder) {
      var el = document.createElement('div');
      builder(el);
      document.getElementById('log').appendChild(el);
    }
    ME.logText = function(text) {
      ME.log(function(el) {
        el.textContent = text;
      });
    };
    ME.logError = function(text) {
      ME.log(function(el) {
        el.textContent = text;
        el.className = 'error';
      });
    };
    ME.getStatus = function(id, action) {
      VK.Api.call('status.get', {user_id : id}, function(r) {
        if (r.response) {
          action(r.response.text);
        }
      });
    }
    ME.auth = function() {
      VK.Auth.login(function(response) {
        if (response.session) {
          ME.logText('User: ' + response.session.mid);
        } else {
          ME.logError('Auth failed!');
        }
      }, 1024);
    };
    ME.watchStatus = function(id) {
      var cur;
      var checkUpdate = function() {
        ME.getStatus(id, function(text) {
          if (text != cur) {
            cur = text;
            ME.logText(id + ' changed status to "' + text + '" at ' + new Date().toString());
          }
        });
        setTimeout(checkUpdate, 100);
      }
      checkUpdate();
    }
  </script>
  <form>
   <input type='button' value='Auth' onClick='ME.auth()'/>
  </form>
  <form onsubmit='var value = document.getElementById("statusId").value; ME.logText("Watching for " + value); ME.watchStatus(value); return false;'>
   <input type='text' id='statusId'/>
   <input type='submit' value='Start watching'/>
  </form>
  <div id='log'>
  </div>
 </body>
</html>
